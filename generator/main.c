#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>

#include "dac.h"
#include <math.h>

uint8_t c;

uint8_t N=200;
uint16_t values[]={4095,4054,4013,3972,3931,3890,3849,3808,3767,3726,3686,3645,3604,3563,3522,3481,3440,3399,3358,3317,3276,3235,3194,3153,3112,3071,3030,2989,2948,2907,2867,2826,2785,2744,2703,2662,2621,2580,2539,2498,2457,2416,2375,2334,2293,2252,2211,2170,2129,2088,2047,2007,1966,1925,1884,1843,1802,1761,1720,1679,1638,1597,1556,1515,1474,1433,1392,1351,1310,1269,1228,1188,1147,1106,1065,1024,983,942,901,860,819,778,737,696,655,614,573,532,491,450,409,369,328,287,246,205,164,123,82,41,0,41,82,123,164,205,246,287,328,369,410,450,491,532,573,614,655,696,737,778,819,860,901,942,983,1024,1065,1106,1147,1188,1229,1269,1310,1351,1392,1433,1474,1515,1556,1597,1638,1679,1720,1761,1802,1843,1884,1925,1966,2007,2048,2088,2129,2170,2211,2252,2293,2334,2375,2416,2457,2498,2539,2580,2621,2662,2703,2744,2785,2826,2867,2907,2948,2989,3030,3071,3112,3153,3194,3235,3276,3317,3358,3399,3440,3481,3522,3563,3604,3645,3686,3726,3767,3808,3849,3890,3931,3972,4013,4054};

ISR(TIMER1_COMPB_vect) {
	TCNT1=0x0000;
	dac_send(values[c]);
	if(c>=(N-1)) c=0;
	else c++;
}

int main() {
	c=0;
	dac_init();

	TCCR1A=0;
	TCNT1=0x0000;
	OCR1B=0x0001;
	
	TIMSK1|=(1<<OCIE1B);
	TCCR1B=0x001;
	
	sei();
	
	for(;;);
	
	return;
}
